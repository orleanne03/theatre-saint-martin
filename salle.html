/* === 📱 Zoom + déplacement fluide sur mobile === */
const wrapper = document.querySelector(".hall-wrapper");
// ⚠️ pas besoin de redéclarer `hall`, il existe déjà
let scale = 1;
let minScale = 0.8;
let maxScale = 3;
let lastDist = 0;
let lastTouch = null;
let pos = { x: 0, y: 0 };
let lastPos = { x: 0, y: 0 };
let isPanning = false;

wrapper.style.touchAction = "none"; // on gère nous-mêmes les gestes

function setTransform() {
  hall.style.transform = `translate(${pos.x}px, ${pos.y}px) scale(${scale})`;
}

wrapper.addEventListener("touchstart", (e) => {
  if (e.touches.length === 2) {
    // --- Début du pinch ---
    const [t1, t2] = e.touches;
    const dx = t1.clientX - t2.clientX;
    const dy = t1.clientY - t2.clientY;
    lastDist = Math.hypot(dx, dy);
    isPanning = false;
  } else if (e.touches.length === 1) {
    // --- Déplacement à un doigt ---
    lastTouch = { x: e.touches[0].clientX, y: e.touches[0].clientY };
    isPanning = true;
  }
});

wrapper.addEventListener("touchmove", (e) => {
  if (e.touches.length === 2) {
    // --- Zoom à deux doigts ---
    e.preventDefault();
    const [t1, t2] = e.touches;
    const dx = t1.clientX - t2.clientX;
    const dy = t1.clientY - t2.clientY;
    const dist = Math.hypot(dx, dy);

    if (lastDist) {
      const delta = dist / lastDist;
      scale = Math.max(minScale, Math.min(maxScale, scale * delta));
      setTransform();
    }
    lastDist = dist;
  } else if (e.touches.length === 1 && isPanning) {
    // --- Pan / déplacement ---
    const touch = e.touches[0];
    const dx = touch.clientX - lastTouch.x;
    const dy = touch.clientY - lastTouch.y;
    pos.x += dx;
    pos.y += dy;
    lastTouch = { x: touch.clientX, y: touch.clientY };
    setTransform();
  }
});

wrapper.addEventListener("touchend", () => {
  if (e.touches?.length < 2) lastDist = 0;
  if (e.touches?.length === 0) isPanning = false;
});
