<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>üéüÔ∏è R√©servation ‚Äî Th√©√¢tre Saint Martin</title>
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.0/build/qrcode.min.js"></script>
<style>
body {
  font-family: "Segoe UI", sans-serif;
  background: linear-gradient(180deg,#f3f4f6,#e3f2fd);
  color:#212121;
  margin:0;
  padding:20px;
  text-align:center;
}
h1 { color:#0d47a1; margin-bottom:6px; }
#seats {
  display:grid;
  grid-template-columns:repeat(16,32px);
  gap:6px;
  justify-content:center;
  margin:20px auto;
}
.seat {
  width:32px;height:32px;
  border-radius:6px;
  background:#e0e0e0;
  cursor:pointer;
  transition:background .3s;
  display:flex;align-items:center;justify-content:center;
  font-size:11px;
}
.seat:hover{background:#90caf9;}
.seat.reserved{background:#c62828;color:#fff;cursor:not-allowed;}
.seat.selected{background:#1565c0;color:#fff;}
#legend{display:flex;gap:12px;justify-content:center;margin:12px 0;}
.legend-item{display:flex;align-items:center;gap:6px;}
.legend-color{width:20px;height:20px;border-radius:4px;}
#modal {
  position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;
}
#modalContent {
  background:#fff;padding:20px;border-radius:10px;width:300px;
  text-align:left;box-shadow:0 4px 12px rgba(0,0,0,.3);
}
input{width:100%;padding:8px;margin:6px 0;border-radius:6px;border:1px solid #ccc;}
button{padding:10px 14px;border:none;border-radius:8px;cursor:pointer;color:#fff;margin:6px;}
.btn-reserve{background:#1976d2;}
.btn-close{background:#757575;}
#qrZone{margin-top:20px;}
  #modal {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0, 0, 0, .6);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 9999;           /* üîπ tr√®s important sur mobile */
  touch-action: none;      /* üîπ emp√™che le scroll qui bloque les clics */
}

@media(max-width:500px){#seats{grid-template-columns:repeat(8,32px)}}
</style>
</head>
<body>
<h1>üé≠ Th√©√¢tre Saint Martin</h1>
<h3>R√©servez vos si√®ges</h3>

<div id="legend">
  <div class="legend-item"><div class="legend-color" style="background:#e0e0e0"></div>Libre</div>
  <div class="legend-item"><div class="legend-color" style="background:#1565c0"></div>S√©lectionn√©</div>
  <div class="legend-item"><div class="legend-color" style="background:#c62828"></div>R√©serv√©</div>
</div>

<div id="seats"></div>

<button class="btn-reserve" onclick="openModal()">R√©server</button>

<div id="modal">
  <div id="modalContent">
    <h3>Informations de r√©servation</h3>
    <input id="name" placeholder="Nom complet">
    <input id="email" placeholder="Adresse email">
    <input id="phone" placeholder="T√©l√©phone">
    <div style="text-align:right;margin-top:10px;">
      <button class="btn-close" onclick="closeModal()">Annuler</button>
      <button class="btn-reserve" onclick="confirmReservation()">Confirmer</button>
    </div>
  </div>
</div>

<div id="qrZone">
  <h3>üéüÔ∏è Votre billet</h3>
  <img id="qrPreview" width="200">
</div>

<script>
const seatContainer=document.getElementById("seats");
let selectedSeats=[];
const rows="ABCDEFGHIJKLMNOPQRS".split("");
const seatsPerRow=["15","13","11","9","7","5","3","1","2","4","6","8","10","12","14","16"];

function renderSeats(){
  seatContainer.innerHTML="";
  for(const row of rows){
    for(const num of seatsPerRow){
      const id=row+"-"+num;
      const seat=document.createElement("div");
      seat.className="seat";
      seat.dataset.id=id;
      seat.title=id;
      seat.textContent=num;
      seat.onclick=()=>toggleSeat(seat);
      seatContainer.appendChild(seat);
    }
  }
  loadReservations();
}
function toggleSeat(seat){
  if(seat.classList.contains("reserved"))return;
  seat.classList.toggle("selected");
  const id=seat.dataset.id;
  if(seat.classList.contains("selected"))selectedSeats.push(id);
  else selectedSeats=selectedSeats.filter(s=>s!==id);
}
function openModal(){
  if(selectedSeats.length===0){alert("Choisissez des si√®ges.");return;}
  document.getElementById("modal").style.display="flex";
}
function closeModal(){document.getElementById("modal").style.display="none";}
function confirmReservation(){
  const name=document.getElementById("name").value.trim();
  const email=document.getElementById("email").value.trim();
  const phone=document.getElementById("phone").value.trim();
  if(!name||!email){alert("Nom et email obligatoires.");return;}
  const reservation={nom:name,email,tel:phone,sieges:selectedSeats.join(", "),date_reservation:new Date().toISOString()};
  saveReservation(reservation);
  generateQR(reservation);
  alert("R√©servation enregistr√©e !");
  document.getElementById("modal").style.display="none";
}
function saveReservation(r){
  const all=JSON.parse(localStorage.getItem("reservations")||"[]");
  all.push(r);
  localStorage.setItem("reservations",JSON.stringify(all));
  for(const s of selectedSeats){
    const el=document.querySelector(`[data-id='${s}']`);
    if(el){el.classList.remove("selected");el.classList.add("reserved");}
  }
  selectedSeats=[];
}
function loadReservations(){
  const all=JSON.parse(localStorage.getItem("reservations")||"[]");
  for(const r of all){
    for(const s of r.sieges.split(", ")){
      const el=document.querySelector(`[data-id='${s}']`);
      if(el)el.classList.add("reserved");
    }
  }
}
function generateQR(data){
  // ‚úÖ Encodage s√ªr compatible avec le scanner
  const qrData=encodeURIComponent(JSON.stringify(data));
  QRCode.toDataURL(qrData,{width:300,margin:1})
    .then(url=>{document.getElementById("qrPreview").src=url;})
    .catch(err=>console.error(err));
}
  // üîπ ferme le clavier quand on tape sur le bouton Confirmer
document.getElementById("modalContent").addEventListener("touchstart", (e) => {
  if (e.target.tagName === "BUTTON") {
    document.activeElement.blur();
  }
});

window.onload=renderSeats;
</script>
</body>
</html>

