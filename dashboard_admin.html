<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Tableau de bord ‚Äì Th√©√¢tre Saint Martin</title>

<style>
  :root{
    --gold: #d7b33a;
    --gold-soft:#e3c86a;
    --burgundy:#3a0c0c;
    --burgundy-deep:#240606;
    --card:#f6ead6;     /* beige doux des cartes */
    --ink:#2b1b16;      /* texte brun fonc√© */
    --accent:#8e1c1c;   /* rouge ic√¥nes */
    --shadow: rgba(0,0,0,.45);
  }

  /* ---- Fond rideaux & assombrissement l√©ger pour contraste ---- */
  body{
    margin:0;
    font-family: "Poppins","Segoe UI",system-ui,-apple-system,sans-serif;
    min-height:100vh;
    color:var(--ink);
    background:
      linear-gradient(to bottom, rgba(0,0,0,.35), rgba(0,0,0,.55)),
      url("https://images.unsplash.com/photo-1606761568499-6e7187c8b47e?auto=format&fit=crop&w=1600&q=80")
      center top / cover no-repeat fixed;
    display:flex; flex-direction:column; align-items:center;
  }

  /* ---- Bandeau dor√© ---- */
  header{
    width:100%;
    background: linear-gradient(90deg, #ffda59, #ffbe2e);
    color:#5a0c0c;
    text-align:center;
    font-weight:800;
    letter-spacing:.5px;
    padding:14px 12px;
    font-size:1.25rem;
    text-shadow:0 1px 0 #fff6c9;
    box-shadow:0 2px 10px var(--shadow);
  }

  /* ---- Container fa√ßon ‚Äút√©l√©phone‚Äù sombre ---- */
  .phone{
    width:min(430px, 92vw);
    background: #2a0a0a;
    border-radius:28px;
    box-shadow:0 18px 40px var(--shadow), inset 0 0 0 3px rgba(0,0,0,.3);
    margin:22px auto 28px;
    padding:18px 16px 22px;
  }

  /* ---- Titre ‚ÄúTABLEAU DE BORD‚Äù dor√© dans le cadre sombre ---- */
  .title{
    color: var(--gold);
    font-weight:900;
    font-size:1.3rem;
    text-align:center;
    margin:4px 0 12px;
    letter-spacing:.6px;
  }

  /* ---- Cartes beiges arrondies ---- */
  .card{
    display:flex; align-items:center;
    gap:16px;
    background:var(--card);
    border-radius:18px;
    padding:16px;
    box-shadow: 0 10px 20px rgba(0,0,0,.22);
    border: 1px solid rgba(0,0,0,.08);
    margin:12px 6px;
  }
  .icon{
    flex:0 0 54px; height:54px; width:54px;
    display:grid; place-items:center;
    border-radius:12px;
    background: #f3d4c9;
    box-shadow: inset 0 -2px 0 rgba(0,0,0,.08);
  }
  .icon svg{ width:32px; height:32px; fill: var(--accent); }

  .text{
    display:flex; justify-content:space-between; align-items:center;
    gap:10px; width:100%;
  }
  .label{
    color:#4a2b21; font-weight:700; font-size:1.05rem;
  }
  .value{
    color:#1c1310; font-weight:900; font-size:1.65rem;
  }

  /* ---- Ligne d‚Äôalerte en bas de la 3e carte ---- */
  .meta{
    color:#a22020; font-weight:800; font-size:.95rem;
  }

  /* ---- Panneau d‚Äôalertes hors des cartes (texte simple) ---- */
  .alerts{
    margin:8px 10px 0;
    color:#f4e7c7;
    font-weight:600;
    font-size:.95rem;
  }

  /* ---- Bandeau ‚ÄúVENTES DE BILLETS‚Äù ---- */
  .section{
    margin:16px 10px 10px;
    color: var(--gold);
    font-weight:900;
    text-align:center;
    font-size:1.15rem;
    letter-spacing:.5px;
  }

  /* ---- Boutons rouges arrondis ---- */
  .actions{
    display:grid; grid-template-columns:1fr 1fr; gap:14px;
    margin:6px 10px 4px;
  }
  .btn{
    background: linear-gradient(180deg, #8f2323, #6c1717);
    color: #f8e6b2;
    border:none; border-radius:16px;
    padding:14px 10px; font-weight:800; font-size:.98rem;
    box-shadow: 0 8px 18px rgba(0,0,0,.35), inset 0 -2px 0 rgba(0,0,0,.25);
    cursor:pointer; transition: transform .06s ease, filter .15s ease;
  }
  .btn:active{ transform: translateY(1px); filter:brightness(.95); }

  footer{
    color:#f1d9d0; opacity:.85; font-size:.8rem; margin-bottom:16px;
    text-shadow:0 1px 3px rgba(0,0,0,.5);
  }

  @media (min-width: 480px){
    .value{ font-size:1.9rem }
    .label{ font-size:1.1rem }
  }
</style>
</head>

<body>
  <header>Tableau de bord ‚Äì Th√©√¢tre Saint Martin</header>

  <main class="phone">
    <div class="title">TABLEAU DE BORD</div>

    <!-- Carte 1 : R√©servations -->
    <div class="card">
      <div class="icon" aria-hidden="true">
        <!-- Calendrier -->
        <svg viewBox="0 0 24 24"><path d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11zM7 11h5v5H7z"/></svg>
      </div>
      <div class="text">
        <div class="label">R√©servations</div>
        <div class="value" id="val-res">0</div>
      </div>
    </div>

    <!-- Carte 2 : Encaissement global -->
    <div class="card">
      <div class="icon" aria-hidden="true">
        <!-- Euro rond -->
        <svg viewBox="0 0 24 24"><path d="M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20zm1.9 14.5a4.9 4.9 0 0 1-4.7-3.5H7.5v-1h1.4a5.1 5.1 0 0 1 0-1H7.5v-1h1.7a4.9 4.9 0 0 1 4.7-3.5c.7 0 1.4.1 2 .3l-.3 1.3c-.6-.2-1.2-.3-1.8-.3-1.7 0-3 .9-3.6 2.2h3.1v1H9.9l0 .5 0 .5h3.3v1H8.8c.6 1.4 2 2.3 3.6 2.3.6 0 1.2-.1 1.8-.3l.3 1.3c-.6.2-1.3.3-2 .3z"/></svg>
      </div>
      <div class="text">
        <div class="label">Encaissement global</div>
        <div class="value" id="val-amount">0 ‚Ç¨</div>
      </div>
    </div>

    <!-- Carte 3 : Taux de remplissage + alertes -->
    <div class="card">
      <div class="icon" aria-hidden="true">
        <!-- Masque th√©√¢tre -->
        <svg viewBox="0 0 24 24"><path d="M12 3C7 3 3 5 3 5v6c0 3.9 3.1 7 7 7 .9 0 1.7-.2 2.5-.5.8.3 1.6.5 2.5.5 3.9 0 7-3.1 7-7V5s-4-2-10-2zm-3.2 7.2a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm6.4 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zM7.5 13c1.2 1 2.6 1.5 4.1 1.5S14.5 14 15.7 13l-.7 1.5c-1.3.8-2.8 1.2-4.4 1.2s-3.1-.4-4.4-1.2L7.5 13z"/></svg>
      </div>
      <div class="text">
        <div class="label">Taux de remplissage</div>
        <div style="display:flex; flex-direction:column; align-items:flex-end;">
          <div class="value" id="val-fill">0%</div>
          <div class="meta" id="val-alerts">0 alerte</div>
        </div>
      </div>
    </div>

    <!-- Panneau d‚Äôalertes -->
    <div class="alerts" id="alerts">Chargement des donn√©es...</div>

    <!-- Bandeau & boutons -->
    <div class="section">Ventes de billets</div>
    <div class="actions">
      <button class="btn" id="btnNew">NOUVELLE VENTE</button>
      <button class="btn" id="btnScan">V√âRIFIER BILLET</button>
    </div>
  </main>

  <footer>¬© Th√©√¢tre Saint Martin ‚Äì Tableau de bord admin</footer>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

  /* ‚ö†Ô∏è Mets tes vraies valeurs comme dans ton app principale */
  const firebaseConfig = {
    apiKey: "AIzaSyXXXX_TON_API_KEY",
    authDomain: "theatre-saint-martin.firebaseapp.com",
    databaseURL: "https://theatre-saint-martin-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "theatre-saint-martin",
    storageBucket: "theatre-saint-martin.appspot.com",
    messagingSenderId: "1234567890",
    appId: "1:1234567890:web:abcd1234efgh"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const seatsRef = ref(db, "seats");

  const TOTAL_SEATS = 304;
  const PRICE_ADULT = 14;
  const PRICE_CHILD = 10;

  onValue(seatsRef, snap=>{
    const seats = snap.val()||{};
    const list = Object.values(seats);

    // R√©servations
    const totalReserved = list.length;

    // Encaissement global = uniquement si√®ges pay√©s (adultes/enfants)
    let totalAmount = 0;
    for(const s of list){
      if(!s.paid) continue;
      if(s.type==="adulte") totalAmount += PRICE_ADULT;
      else if(s.type==="enfant") totalAmount += PRICE_CHILD;
    }

    // Taux & alertes
    const fill = TOTAL_SEATS>0 ? (totalReserved/TOTAL_SEATS*100) : 0;
    const unpaidCount = list.filter(s=>!s.paid).length;

    // UI
    document.getElementById("val-res").textContent = totalReserved.toString();
    document.getElementById("val-amount").textContent = totalAmount.toFixed(2)+" ‚Ç¨";
    document.getElementById("val-fill").textContent = fill.toFixed(0)+"%";
    document.getElementById("val-alerts").textContent =
      `${unpaidCount} ${unpaidCount>1?"alertes":"alerte"}`;

    // Panneau d‚Äôalertes textuel
    const alerts = [];
    if(fill>=90) alerts.push("üö® Salle presque compl√®te.");
    else if(fill>=70) alerts.push("‚ö†Ô∏è Salle bient√¥t pleine.");
    if(unpaidCount>0) alerts.push(`üí≥ ${unpaidCount} r√©servation(s) non pay√©e(s).`);
    if(alerts.length===0) alerts.push("‚úÖ Aucun probl√®me d√©tect√©.");
    document.getElementById("alerts").innerHTML = alerts.map(a=>`<div>${a}</div>`).join("");
  });

  // Lecture seule
  document.getElementById("btnNew").onclick = ()=>alert("Lecture seule ‚Äì action d√©sactiv√©e.");
  document.getElementById("btnScan").onclick = ()=>alert("Lecture seule ‚Äì action d√©sactiv√©e.");
</script>
</body>
</html>
