<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>🎭 Tableau de bord – Théâtre Saint Martin</title>

  <style>
    body {
      margin: 0;
      font-family: "Poppins", "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #6d0019, #1a0006 90%);
      color: #fff8e1;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }

    header {
      background: linear-gradient(90deg, #b71c1c, #880e4f);
      width: 100%;
      text-align: center;
      padding: 15px 0;
      font-weight: 700;
      font-size: 1.3rem;
      color: #ffeb3b;
      letter-spacing: 1px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.4);
    }

    .dashboard {
      margin-top: 25px;
      width: 90%;
      max-width: 420px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .card {
      background: linear-gradient(145deg, #b71c1c, #4a0010);
      border-radius: 16px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.4);
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      color: #fff8e1;
      transition: transform 0.2s ease;
    }
    .card:hover {
      transform: scale(1.02);
    }

    .card .icon {
      width: 38px;
      height: 38px;
      fill: #ffeb3b;
      flex-shrink: 0;
    }
    .card .info {
      text-align: right;
    }
    .card .title {
      font-size: 0.9rem;
      opacity: 0.9;
    }
    .card .value {
      font-size: 1.6rem;
      font-weight: 700;
      color: #fffde7;
    }

    .alerts {
      background: rgba(255,255,255,0.08);
      border-radius: 12px;
      width: 90%;
      max-width: 420px;
      padding: 10px 15px;
      margin-top: 20px;
      font-size: 0.95rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }

    .actions {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-top: 25px;
      width: 90%;
      max-width: 420px;
    }
    .actions button {
      flex: 1;
      background: linear-gradient(90deg, #c62828, #ad1457);
      border: none;
      border-radius: 10px;
      color: #fff;
      padding: 12px 0;
      font-weight: 600;
      font-size: 0.95rem;
      box-shadow: 0 3px 8px rgba(0,0,0,0.3);
      cursor: pointer;
      transition: opacity 0.2s ease;
    }
    .actions button:hover {
      opacity: 0.85;
    }

    footer {
      margin-top: auto;
      padding: 15px 0;
      font-size: 0.75rem;
      opacity: 0.7;
    }
  </style>
</head>

<body>
  <header>🎭 TABLEAU DE BORD ADMIN</header>

  <section class="dashboard">
    <div class="card">
      <svg class="icon" viewBox="0 0 24 24">
        <path d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.1 0-2 .9-2 
        2v14c0 1.1.9 2 2 2h14c1.1 0 
        2-.9 2-2V6c0-1.1-.9-2-2-2zm0 
        16H5V9h14v11zM7 11h5v5H7z"/>
      </svg>
      <div class="info">
        <div class="title">Réservations</div>
        <div class="value" id="totalReserved">0</div>
      </div>
    </div>

    <div class="card">
      <svg class="icon" viewBox="0 0 24 24">
        <path d="M12 1C5.925 1 1 5.925 1 
        12s4.925 11 11 11 11-4.925 
        11-11S18.075 1 12 1zm0 
        20c-4.97 0-9-4.03-9-9s4.03-9 
        9-9 9 4.03 9 9-4.03 9-9 
        9zm.5-13h-1v4.25l3.5 
        2.1.5-.85-3-1.8V8z"/>
      </svg>
      <div class="info">
        <div class="title">Encaissement global</div>
        <div class="value" id="totalAmount">0 €</div>
      </div>
    </div>

    <div class="card">
      <svg class="icon" viewBox="0 0 24 24">
        <path d="M12 2C8.13 2 5 5.13 5 
        9c0 5.25 7 13 7 13s7-7.75 
        7-13c0-3.87-3.13-7-7-7zm0 
        9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 
        2.5-2.5 2.5 1.12 2.5 
        2.5-1.12 2.5-2.5 2.5z"/>
      </svg>
      <div class="info">
        <div class="title">Taux de remplissage</div>
        <div class="value" id="fillRate">0%</div>
      </div>
    </div>
  </section>

  <div class="alerts" id="alerts">
    Chargement des données...
  </div>

  <div class="actions">
    <button id="btnNew">Nouvelle vente</button>
    <button id="btnScan">Vérifier billet</button>
  </div>

  <footer>© Théâtre Saint Martin – Tableau de bord admin</footer>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyXXXX_TON_API_KEY",
      authDomain: "theatre-saint-martin.firebaseapp.com",
      databaseURL: "https://theatre-saint-martin-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "theatre-saint-martin",
      storageBucket: "theatre-saint-martin.appspot.com",
      messagingSenderId: "1234567890",
      appId: "1:1234567890:web:abcd1234efgh"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const seatsRef = ref(db, "seats");

    const TOTAL_SEATS = 304;

    onValue(seatsRef, snapshot => {
      const seats = snapshot.val() || {};
      const values = Object.values(seats);

      const reserved = values.length;
      const paid = values.filter(s => s.paid);
      const unpaid = values.filter(s => !s.paid);
      
      let totalPaid = 0;
      for (const s of paid) {
        if (s.type === "adulte") totalPaid += 14;
        if (s.type === "enfant") totalPaid += 10;
      }

      document.getElementById("totalReserved").textContent = reserved;
      document.getElementById("totalAmount").textContent = totalPaid.toFixed(2) + " €";
      const fill = ((reserved / TOTAL_SEATS) * 100).toFixed(1);
      document.getElementById("fillRate").textContent = fill + "%";

      updateAlerts(fill, unpaid.length);
    });

    function updateAlerts(fillRate, unpaid) {
      const alerts = [];
      if (fillRate >= 90) alerts.push("🚨 Salle presque complète !");
      else if (fillRate >= 70) alerts.push("⚠️ Salle bientôt pleine.");
      if (unpaid > 0) alerts.push(`💳 ${unpaid} réservation(s) non payée(s).`);
      if (alerts.length === 0) alerts.push("✅ Aucun problème détecté.");
      document.getElementById("alerts").innerHTML = alerts.map(a => `<div>${a}</div>`).join("");
    }

    // Navigation (optionnelle)
    document.getElementById("btnNew").onclick = () => alert("Fonction en lecture seule");
    document.getElementById("btnScan").onclick = () => alert("Fonction en lecture seule");
  </script>
</body>
</html>
